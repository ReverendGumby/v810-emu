@0

// TODO
// Test: 'STSR r, PSW' waits for system register writeback

01E0 // MOV r0, r15

4100 // MOV 0, r8  // r8 = 0x00000000

// Set PSW[3:0]
404F 0000 // MOV 0xF, r2
7045 // LDSR r2, PSW

4021 // MOV #1, r1
0C20 // CMP r1, r0      // Clear PSW[3:0]
7525 // STSR r9, PSW    // r9 = 0x00000000
0D09 // CMP r8, r9
8404 // BZ .+4          // Should branch
6800 // HALT

// Pass!

41EF // MOV #15, r15
6800 // HALT
